datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URI")
}

generator client {
  provider = "prisma-client-js"
}

enum UserRole {
  ADMIN
  USER
  AGENT
  SHOPKEEPER
  HELPER
}

model Password {
  id           String @id @default(auto()) @map("_id") @db.ObjectId
  hash         String
  passwordText String
  user         User   @relation(fields: [userId], references: [id])
  userId       String @unique @db.ObjectId
}

model User {
  id          String       @id @default(auto()) @map("_id") @db.ObjectId
  email       String       @unique
  name        String
  phone       String?
  mobile      String?
  password    Password?
  approved    Boolean      @default(true)
  role        UserRole     @default(USER)
  shop        Shop?
  tokens      Token?
  allocatShop AllocatShop?
}

model AllocatShop {
  id     String @id @default(auto()) @map("_id") @db.ObjectId
  shop   Shop   @relation(fields: [shopId], references: [id])
  shopId String @unique @db.ObjectId
  user   User   @relation(fields: [userId], references: [id])
  userId String @unique @db.ObjectId
}

model Shop {
  id       String       @id @default(auto()) @map("_id") @db.ObjectId
  user     User         @relation(fields: [userId], references: [id])
  userId   String       @unique @db.ObjectId
  name     String
  location String
  tokens   Token?
  shopUser AllocatShop?
}

model Token {
  id              String  @id @default(auto()) @map("_id") @db.ObjectId
  shop            Shop    @relation(fields: [shopId], references: [id])
  shopId          String  @unique @db.ObjectId
  user            User    @relation(fields: [userId], references: [id])
  userId          String  @unique @db.ObjectId
  cnic            String?
  name            String?
  tokenNumber     String
  getCommission   String?
  agentCommission String?
  highPriority    Boolean @default(false)
}
